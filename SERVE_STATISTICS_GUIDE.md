# サーブ統計機能 実装ガイド

## 実装された機能

### 1. サーブプレイヤーの表示
- 各ポイントでどちらの選手がサーブをしているかを表示
- シングルス・ダブルス両方に対応

### 2. ダブルスでのサーブプレイヤー選択
- ダブルスの場合、どちらの選手がサーブするかをゲーム開始時に選択可能
- デフォルトは0番目（最初の選手）に設定

### 3. サーブプレイヤーのゲーム毎選択
- 各ゲーム開始時に、そのゲームでサーブする選手を選択可能
- 前のゲームの情報を引き継ぎつつ、変更も可能

### 4. サーブ統計の記録・表示
- 各選手のサーブ統計を記録し表示
- 統計項目：
  - 総サーブ数
  - エース数
  - ダブルフォルト数
  - 1stサーブ成功率
  - ダブルフォルト率

## 修正されたファイル

### 1. データベーススキーマ
- `games` テーブルに `initial_serve_player_index` フィールドを追加
- `points` テーブルに `serving_player` フィールドを追加

### 2. 型定義 (`src/types/database.ts`)
```typescript
// Game インターフェースに追加
initial_serve_player_index?: number | null;

// Point インターフェースに追加
serving_player: string | null;
```

### 3. サーブヘルパー関数 (`lib/serveHelpers.ts`)
- `getCurrentServingPlayerIndex` 関数を追加
- ダブルスでのプレイヤー交代ロジックを実装

### 4. サーブ選択コンポーネント (`src/components/ServeSelection.tsx`)
- 2段階選択UI（チーム → プレイヤー）
- プリセレクションとデフォルト値の処理

### 5. 試合入力ページ (`src/pages/beta/matches/[matchId]/input.tsx`)
- サーブプレイヤーの追跡と記録
- ゲーム開始時のサーブ選択処理

### 6. ポイント API (`src/pages/api/matches/[matchId]/points/index.ts`)
- `serving_player` フィールドのデータベース保存処理

### 7. 試合結果ページ (`src/pages/beta/matches-results/[matchId]/index.tsx`)
- サーブ統計の計算と表示
- 各選手のサーブパフォーマンス表示

## 使用方法

### 1. 試合入力
1. 試合入力ページで新しいゲームを開始
2. サーブチームとサーブプレイヤーを選択
3. ポイントを入力（サーブプレイヤーが自動記録）

### 2. 統計確認
1. 試合結果ページにアクセス
2. 各選手の統計情報を確認
3. サーブ統計セクションでサーブパフォーマンスを分析

## 技術的な特徴

- TypeScript による型安全性
- React hooks を使用したコンポーネント設計
- Supabase を使用したリアルタイムデータベース
- レスポンシブデザイン対応
- エラーハンドリング付き

## 今後の拡張可能性

- サーブ速度の記録
- サーブコースの記録
- 詳細なサーブ分析
- チャート・グラフでの視覚化
- 選手比較機能